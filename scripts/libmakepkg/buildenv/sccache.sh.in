#!/usr/bin/bash

[[ -n "$LIBMAKEPKG_BUILDENV_SCCACHE_SH" ]] && return
LIBMAKEPKG_BUILDENV_SCCACHE_SH=1

MAKEPKG_LIBRARY=${MAKEPKG_LIBRARY:-'@libmakepkgdir@'}

source "$MAKEPKG_LIBRARY/util/option.sh"

build_options+=('sccache')
buildenv_functions+=('buildenv_sccache')

buildenv_sccache() {
	if check_buildoption "sccache" "y"; then
		local sccache
		sccache="$(type -p sccache)"
		if [[ $RUSTC_WRAPPER == "$sccache" ]]; then
			return 0
		elif [[ ${RUSTC_WRAPPER+set} ]]; then
			error "$(gettext "%s option was requested but %s environment variable is already set to %s.")" "sccache" '$RUSTC_WRAPPER' "${RUSTC_WRAPPER@Q}"
			return 1
		fi
		export RUSTC_WRAPPER="$sccache"
	fi
}
